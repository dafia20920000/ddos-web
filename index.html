<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Kirim Info ke Server</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f7f7f7;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .panel-admin {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .panel-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        .btn-download {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            display: block;
            margin: 20px auto;
        }
        .btn-download:hover {
            background-color: #45a049;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .info-table th, .info-table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        .info-table th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>

    <!-- Panel Admin -->
    <div class="panel-admin">
        <div class="panel-header">
            <h2>Panel Admin</h2>
            <img src="https://via.placeholder.com/50" alt="Anonymous">
        </div>
        <p>Informasi perangkat yang terkirim akan muncul di tabel di bawah.</p>
        <table class="info-table">
            <thead>
                <tr>
                    <th>Model Perangkat</th>
                    <th>IP Perangkat</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="device-info-table">
                <!-- Data perangkat akan muncul di sini -->
            </tbody>
        </table>
    </div>

    <!-- Tombol Download PDF -->
    <button class="btn-download" onclick="downloadPDF()">Download PDF dan Kirim Info ke Server</button>

    <script>
        // Fungsi untuk mendapatkan informasi perangkat
        async function fetchDeviceInfo() {
            let ip = await fetch('https://api64.ipify.org?format=json').then(res => res.json()).then(data => data.ip);
            let userAgent = navigator.userAgent;
            let os = "Tidak Diketahui";
            let model = "Tidak Diketahui";
            
            if (userAgent.includes("Windows")) os = "Windows";
            else if (userAgent.includes("Mac")) os = "MacOS";
            else if (userAgent.includes("Linux")) os = "Linux";
            else if (/Android/.test(userAgent)) os = "Android " + userAgent.match(/Android (\d+\.\d+)/)[1]; // Versi Android
            else if (/iPhone|iPad|iPod/.test(userAgent)) os = "iOS " + userAgent.match(/OS (\d+_\d+)/)[1].replace('_', '.');
            
            if (/Android/.test(userAgent)) model = userAgent.match(/Android.*; (.*?) Build/)[1] || "Model tidak diketahui";
            else if (/iPhone|iPad|iPod/.test(userAgent)) model = "Apple " + userAgent.match(/iPhone|iPad|iPod (.*) like/)[1];
            
            return { ip, os, model };
        }

        // Fungsi untuk membuat dan mendownload PDF
        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            let doc = new jsPDF();
            const deviceInfo = await fetchDeviceInfo();

            // Menambahkan konten ke PDF
            doc.text("Ini adalah file yang tidak dapat dibuka", 10, 10);
            doc.text("Tapi jika dibuka, informasi perangkat akan dikirim ke server.", 10, 20);
            
            // Kirim data ke server Flask
            fetch(`/submit_info?device=${encodeURIComponent(deviceInfo.model)}&ip=${encodeURIComponent(deviceInfo.ip)}`)
                .then(response => response.text())
                .then(data => console.log("Data berhasil dikirim ke server:", data))
                .catch(error => console.error("Error mengirim data:", error));
            
            // Menyimpan PDF
            doc.save("error_file.pdf");
        }
    </script>

</body>
</html>
